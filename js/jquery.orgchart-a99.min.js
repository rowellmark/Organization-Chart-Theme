"use strict";!function(e){"object"==typeof module&&"object"==typeof module.exports?e(require("jquery"),window,document):e(jQuery,window,document)}(function(e,t,n,s){function i(e){return Math.sqrt((e.touches[0].clientX-e.touches[1].clientX)*(e.touches[0].clientX-e.touches[1].clientX)+(e.touches[0].clientY-e.touches[1].clientY)*(e.touches[0].clientY-e.touches[1].clientY))}function a(e,n){var s=e.data("options"),i=e.css("transform"),a="",l=1;"none"===i?e.css("transform","scale("+n+","+n+")"):(a=i.split(","),-1===i.indexOf("3d")?(l=t.parseFloat(a[3])*n,l>s.zoomoutLimit&&l<s.zoominLimit&&e.css("transform",i+" scale("+n+","+n+")")):(l=t.parseFloat(a[1])*n,l>s.zoomoutLimit&&l<s.zoominLimit&&e.css("transform",i+" scale3d("+n+","+n+", 1)")))}function l(t){var n={name:t.contents().eq(0).text().trim(),relationship:(t.parent().parent().is("li")?"1":"0")+(t.siblings("li").length?1:0)+(t.children("ul").length?1:0),contents:t.find("> em").text(),type:t.data("type"),custom_class:t.data("class"),link:t.data("link")};return t[0].id&&(n.id=t[0].id),t.children("ul").children().each(function(){n.children||(n.children=[]),n.children.push(l(e(this)))}),n}function r(e,t){return e.relationship=t+(e.children&&e.children.length>0?1:0),e.children&&e.children.forEach(function(t){r(t,"1"+(e.children.length>1?1:0))}),e}function d(t){var n=t.find("tr:first"),s={id:n.find(".node")[0].id};return n.siblings(":last").children().each(function(){s.children||(s.children=[]),s.children.push(d(e(this)))}),s}function o(t){var t=t||e(this).find(".orgchart");return t.find(".node:first")[0].id?d(t):"Error: Nodes of orghcart to be exported must have id attribute!"}function c(e,t){var n={};return"parent"===t?n=e.closest(".nodes").siblings(":first"):"children"===t?n=e.closest("tr").siblings():"siblings"===t&&(n=e.closest("table").parent().siblings()),n.length?n.is(":visible")?{exist:!0,visible:!0}:{exist:!0,visible:!1}:{exist:!1,visible:!1}}function h(e,t){return"parent"===t?e.closest(".nodes").parent().children(":first").find(".node"):"children"===t?e.closest("table").children(":last").children().find(".node:first"):"siblings"===t?e.closest("table").parent().siblings().find(".node:first"):void 0}function p(e){var t=e.closest("table").closest("tr").siblings();t.eq(0).find(".spinner").length&&e.closest(".orgchart").data("inAjax",!1),c(e,"siblings").visible&&u(e);var n=t.slice(1);n.css("visibility","hidden");var s=t.eq(0).find(".node"),i=c(s,"parent").visible;s.length&&s.is(":visible")&&s.addClass("slide slide-down").one("transitionend",function(){s.removeClass("slide"),n.removeAttr("style"),t.addClass("hidden")}),s.length&&i&&p(s)}function f(t){var n=t.closest("table").closest("tr").siblings().removeClass("hidden");n.eq(2).children().slice(1,-1).addClass("hidden");var s=n.eq(0).find(".node")[0];w(s),e(s).addClass("slide").removeClass("slide-down").one("transitionend",function(){e(s).removeClass("slide"),y(t)&&x(t.children(".topEdge"))})}function g(e){var t=e.closest("tr").siblings();t.last().find(".spinner").length&&e.closest(".orgchart").data("inAjax",!1);var n=t.last().find(".node:visible"),s=t.last().is(".verticalNodes")?!0:!1;if(!s)var i=n.closest("table").closest("tr").prevAll(".lines").css("visibility","hidden");n.addClass("slide slide-up").eq(0).one("transitionend",function(){n.removeClass("slide"),s?t.addClass("hidden"):(i.removeAttr("style").addClass("hidden").siblings(".nodes").addClass("hidden"),t.last().find(".verticalNodes").addClass("hidden")),y(e)&&x(e.children(".bottomEdge"))})}function v(e){var t=e.closest("tr").siblings(),n=t.is(".verticalNodes")?!0:!1,s=n?t.removeClass("hidden").find(".node:visible"):t.removeClass("hidden").eq(2).children().find(".node:first");w(s.get(0)),s.addClass("slide").removeClass("slide-up").eq(0).one("transitionend",function(){s.removeClass("slide"),y(e)&&x(e.children(".bottomEdge"))})}function u(e,t){var n=e.closest("table").parent();n.siblings().find(".spinner").length&&e.closest(".orgchart").data("inAjax",!1),t?"left"===t?n.prevAll().find(".node:visible").addClass("slide slide-right"):n.nextAll().find(".node:visible").addClass("slide slide-left"):(n.prevAll().find(".node:visible").addClass("slide slide-right"),n.nextAll().find(".node:visible").addClass("slide slide-left"));var s=n.siblings().find(".slide"),i=s.closest(".nodes").prevAll(".lines").css("visibility","hidden");s.eq(0).one("transitionend",function(){i.removeAttr("style");var a=t?"left"===t?n.prevAll(":not(.hidden)"):n.nextAll(":not(.hidden)"):n.siblings();n.closest(".nodes").prev().children(":not(.hidden)").slice(1,t?2*a.length+1:-1).addClass("hidden"),s.removeClass("slide"),a.find(".node:visible:gt(0)").removeClass("slide-left slide-right").addClass("slide-up").end().find(".lines, .nodes, .verticalNodes").addClass("hidden").end().addClass("hidden"),y(e)&&E(e)})}function b(t,n){var s=e();s=n?"left"===n?t.closest("table").parent().prevAll().removeClass("hidden"):t.closest("table").parent().nextAll().removeClass("hidden"):t.closest("table").parent().siblings().removeClass("hidden");var i=t.closest("table").closest("tr").siblings();if(n?i.eq(2).children(".hidden").slice(0,2*s.length).removeClass("hidden"):i.eq(2).children(".hidden").removeClass("hidden"),!c(t,"parent").visible){i.removeClass("hidden");var a=i.find(".node")[0];w(a),e(a).addClass("slide").removeClass("slide-down").one("transitionend",function(){e(this).removeClass("slide")})}s.find(".node:visible").addClass("slide").removeClass("slide-left slide-right").eq(-1).one("transitionend",function(){s.find(".node:visible").removeClass("slide"),y(t)&&(E(t),t.children(".topEdge").removeClass("fa-chevron-up").addClass("fa-chevron-down"))})}function m(t,n,s){var i=n.closest(".orgchart");return"undefined"!=typeof i.data("inAjax")&&i.data("inAjax")===!0?!1:(t.addClass("hidden"),n.append('<i class="fa fa-circle-o-notch fa-spin spinner"></i>'),n.children().not(".spinner").css("opacity",.2),i.data("inAjax",!0),e(".oc-export-btn"+(""!==s.chartClass?"."+s.chartClass:"")).prop("disabled",!0),!0)}function C(t,n,s){var i=n.closest("div.orgchart");t.removeClass("hidden"),n.find(".spinner").remove(),n.children().removeAttr("style"),i.data("inAjax",!1),e(".oc-export-btn"+(""!==s.chartClass?"."+s.chartClass:"")).prop("disabled",!1)}function y(e){return e.children(".edge").attr("class").indexOf("fa-")>-1?!0:!1}function x(e){e.toggleClass("fa-chevron-up").toggleClass("fa-chevron-down")}function E(e){var t=e.closest(".orgchart").data("options");if(t.toggleSiblingsResp&&("undefined"==typeof t.ajaxURL||e.closest(".nodes").data("siblingsLoaded"))){var n=e.closest("table").parent().prev();n.length&&(n.is(".hidden")?e.children(".leftEdge").addClass("fa-chevron-left").removeClass("fa-chevron-right"):e.children(".leftEdge").addClass("fa-chevron-right").removeClass("fa-chevron-left"));var s=e.closest("table").parent().next();s.length&&(s.is(".hidden")?e.children(".rightEdge").addClass("fa-chevron-right").removeClass("fa-chevron-left"):e.children(".rightEdge").addClass("fa-chevron-left").removeClass("fa-chevron-right"))}else{var i=e.closest("table").parent().siblings(),a=i.length?!i.is(".hidden"):!1;e.children(".leftEdge").toggleClass("fa-chevron-right",a).toggleClass("fa-chevron-left",!a),e.children(".rightEdge").toggleClass("fa-chevron-left",a).toggleClass("fa-chevron-right",!a)}}function w(e){e&&(e.style.offsetWidth=e.offsetWidth)}function A(i,a,l){e.each(i.children,function(e,t){t.parentId=i.id});var r=e.Deferred(),d=e("<div "+(i.type!=s?'data-type="'+i.type+'"':"")+(i.link!=s?'data-link="'+i.link+'"':"")+(i.custom_class!=s?'data-class="'+i.custom_class+'"':"")+(l.draggable?' draggable="true"':"")+(i[l.nodeId]?' id="'+i[l.nodeId]+'"':"")+(i.parentId?' data-parent="'+i.parentId+'"':"")+">").addClass("node "+(i.className||"")+(a>=l.depth?" slide-up":"")).append('<div class="node-center"></div>');d.find(".node-center").append('<div class="title">'+i[l.nodeTitle]+"</div>").append("undefined"!=typeof l.nodeContent?'<div class="content">'+(i[l.nodeContent]||"")+i.contents+"</div>":"");var o=i.relationship||"";if(l.verticalDepth&&a+2>l.verticalDepth){if(a+1>=l.verticalDepth&&Number(o.substr(2,1))){var h=a+1>=l.depth?"plus":"minus";d.append('<i class="toggleBtn fa fa-'+h+'-square"></i>')}}else Number(o.substr(0,1))&&d.append('<i class="edge verticalEdge topEdge fa"></i>'),Number(o.substr(1,1))&&d.append('<i class="edge horizontalEdge rightEdge fa"></i><i class="edge horizontalEdge leftEdge fa"></i>'),Number(o.substr(2,1))&&d.append('<i class="edge verticalEdge bottomEdge fa"></i>').children(".title").prepend('<i class="fa '+l.parentNodeSymbol+' symbol"></i>');return d.on("mouseenter mouseleave",function(t){var n=e(this),s=!1,i=n.children(".topEdge"),a=(n.children(".rightEdge"),n.children(".bottomEdge")),l=n.children(".leftEdge");"mouseenter"===t.type?(i.length&&(s=c(n,"parent").visible,i.toggleClass("fa-chevron-up",!s).toggleClass("fa-chevron-down",s)),a.length&&(s=c(n,"children").visible,a.toggleClass("fa-chevron-down",!s).toggleClass("fa-chevron-up",s)),l.length&&E(n)):n.children(".edge").removeClass("fa-chevron-up fa-chevron-down fa-chevron-right fa-chevron-left")}),d.on("click",function(t){e(this).closest(".orgchart").find(".focused").removeClass("focused"),e(this).addClass("focused")}),d.on("click",".topEdge",function(t){t.stopPropagation();var n=e(this),s=n.parent(),a=c(s,"parent");if(a.exist){var r=s.closest("table").closest("tr").siblings(":first").find(".node");if(r.is(".slide"))return;a.visible?(p(s),r.one("transitionend",function(){y(s)&&(x(n),E(s))})):f(s)}else{var d=n.parent()[0].id;m(n,s,l)&&e.ajax({url:e.isFunction(l.ajaxURL.parent)?l.ajaxURL.parent(i):l.ajaxURL.parent+d,dataType:"json"}).done(function(t){s.closest(".orgchart").data("inAjax")&&(e.isEmptyObject(t)||N.call(s.closest(".orgchart").parent(),s,t,l))}).fail(function(){console.log("Failed to get parent node data")}).always(function(){C(n,s,l)})}}),d.on("click",".bottomEdge",function(t){t.stopPropagation();var n=e(this),s=n.parent(),a=c(s,"children");if(a.exist){var r=s.closest("tr").siblings(":last");if(r.find(".node:visible").is(".slide"))return;a.visible?g(s):v(s)}else{var d=n.parent()[0].id;m(n,s,l)&&e.ajax({url:e.isFunction(l.ajaxURL.children)?l.ajaxURL.children(i):l.ajaxURL.children+d,dataType:"json"}).done(function(t,n,i){s.closest(".orgchart").data("inAjax")&&t.children.length&&q(s,t,e.extend({},l,{depth:0}))}).fail(function(e,t,n){console.log("Failed to get children nodes data")}).always(function(){C(n,s,l)})}}),d.on("click",".toggleBtn",function(t){var n=e(this),s=n.parent().next(),i=s.find(".node"),a=s.children().children(".node");a.is(".slide")||(n.toggleClass("fa-plus-square fa-minus-square"),i.eq(0).is(".slide-up")?(s.removeClass("hidden"),w(a.get(0)),a.addClass("slide").removeClass("slide-up").eq(0).one("transitionend",function(){a.removeClass("slide")})):(i.addClass("slide slide-up").eq(0).one("transitionend",function(){i.removeClass("slide"),i.closest("ul").addClass("hidden")}),i.find(".toggleBtn").removeClass("fa-minus-square").addClass("fa-plus-square")))}),d.on("click",".leftEdge, .rightEdge",function(t){t.stopPropagation();var n=e(this),s=n.parent(),a=c(s,"siblings");if(a.exist){var r=s.closest("table").parent().siblings();if(r.find(".node:visible").is(".slide"))return;if(l.toggleSiblingsResp){var d=s.closest("table").parent().prev(),o=s.closest("table").parent().next();n.is(".leftEdge")?d.is(".hidden")?b(s,"left"):u(s,"left"):o.is(".hidden")?b(s,"right"):u(s,"right")}else a.visible?u(s):b(s)}else{var h=n.parent()[0].id,p=c(s,"parent").exist?e.isFunction(l.ajaxURL.siblings)?l.ajaxURL.siblings(i):l.ajaxURL.siblings+h:e.isFunction(l.ajaxURL.families)?l.ajaxURL.families(i):l.ajaxURL.families+h;m(n,s,l)&&e.ajax({url:p,dataType:"json"}).done(function(e,t,n){s.closest(".orgchart").data("inAjax")&&(e.siblings||e.children)&&F(s,e,l)}).fail(function(e,t,n){console.log("Failed to get sibling nodes data")}).always(function(){C(n,s,l)})}}),l.draggable&&d.on("dragstart",function(s){var i=s.originalEvent,a=/firefox/.test(t.navigator.userAgent.toLowerCase());if(a&&i.dataTransfer.setData("text/html","hack for firefox"),"none"!==d.closest(".orgchart").css("transform")){var r,o;n.querySelector(".ghost-node")?(r=d.closest(".orgchart").children(".ghost-node").get(0),o=e(r).children().get(0)):(r=n.createElementNS("http://www.w3.org/2000/svg","svg"),r.classList.add("ghost-node"),o=n.createElementNS("http://www.w3.org/2000/svg","rect"),r.appendChild(o),d.closest(".orgchart").append(r));var c=d.closest(".orgchart").css("transform").split(","),h=Math.abs(t.parseFloat("t2b"===l.direction||"b2t"===l.direction?c[0].slice(c[0].indexOf("(")+1):c[1]));r.setAttribute("width",d.outerWidth(!1)),r.setAttribute("height",d.outerHeight(!1)),o.setAttribute("x",5*h),o.setAttribute("y",5*h),o.setAttribute("width",120*h),o.setAttribute("height",40*h),o.setAttribute("rx",4*h),o.setAttribute("ry",4*h),o.setAttribute("stroke-width",1*h);var p=i.offsetX*h,f=i.offsetY*h;if("l2r"===l.direction?(p=i.offsetY*h,f=i.offsetX*h):"r2l"===l.direction?(p=d.outerWidth(!1)-i.offsetY*h,f=i.offsetX*h):"b2t"===l.direction&&(p=d.outerWidth(!1)-i.offsetX*h,f=d.outerHeight(!1)-i.offsetY*h),a){o.setAttribute("fill","rgb(255, 255, 255)"),o.setAttribute("stroke","rgb(191, 0, 0)");var g=n.createElement("img");g.src="data:image/svg+xml;utf8,"+(new XMLSerializer).serializeToString(r),i.dataTransfer.setDragImage(g,p,f)}else i.dataTransfer.setDragImage(r,p,f)}var v=e(this),u=v.closest(".nodes").siblings().eq(0).find(".node:first"),b=v.closest("table").find(".node");v.closest(".orgchart").data("dragged",v).find(".node").each(function(t,n){-1===b.index(n)&&(l.dropCriteria?l.dropCriteria(v,u,e(n))&&e(n).addClass("allowedDrop"):e(n).addClass("allowedDrop"))})}).on("dragover",function(t){t.preventDefault(),e(this).is(".allowedDrop")||(t.originalEvent.dataTransfer.dropEffect="none")}).on("dragend",function(t){e(this).closest(".orgchart").find(".allowedDrop").removeClass("allowedDrop")}).on("drop",function(t){var n=e(this),s=n.closest(".orgchart"),i=s.data("dragged");s.find(".allowedDrop").removeClass("allowedDrop");var a=i.closest(".nodes").siblings().eq(0).children();if(n.closest("tr").siblings().length){var l=parseInt(n.parent().attr("colspan"))+2,r='<i class="edge horizontalEdge rightEdge fa"></i><i class="edge horizontalEdge leftEdge fa"></i>';n.closest("tr").next().addBack().children().attr("colspan",l),i.find(".horizontalEdge").length||i.append(r),n.closest("tr").siblings().eq(1).children(":last").before('<td class="leftLine topLine">&nbsp;</td><td class="rightLine topLine">&nbsp;</td>').end().next().append(i.closest("table").parent());var d=i.closest("table").parent().siblings().find(".node:first");1===d.length&&d.append(r)}else n.append('<i class="edge verticalEdge bottomEdge fa"></i>').parent().attr("colspan",2).parent().after('<tr class="lines"><td colspan="2"><div class="downLine"></div></td></tr><tr class="lines"><td class="rightLine">&nbsp;</td><td class="leftLine">&nbsp;</td></tr><tr class="nodes"></tr>').siblings(":last").append(i.find(".horizontalEdge").remove().end().closest("table").parent());var o=parseInt(a.attr("colspan"));if(o>2){a.attr("colspan",o-2).parent().next().children().attr("colspan",o-2).end().next().children().slice(1,3).remove();var c=a.parent().siblings(".nodes").children().find(".node:first");1===c.length&&c.find(".horizontalEdge").remove()}else a.removeAttr("colspan").find(".bottomEdge").remove().end().end().siblings().remove();s.triggerHandler({type:"nodedropped.orgchart",draggedNode:i,dragZone:a.children(),dropZone:n})}),l.createNode&&l.createNode(d,i),r.resolve(d),r.promise()}function L(t,n,s,i,a){var l,r=n.children,d=r?r.length:!1,o=i.verticalDepth&&s+1>=i.verticalDepth?!0:!1;if(Object.keys(n).length>1&&(l=o?t:e("<table>"),o||t.append(l),e.when(A(n,s,i)).done(function(e){o?l.append(e):l.append(e.wrap("<tr><td"+(d?' colspan="'+2*r.length+'"':"")+"></td></tr>").closest("tr")),a&&a()}).fail(function(){console.log("Failed to creat node")})),d){1===Object.keys(n).length&&(l=t);var c=s+1>=i.depth||n.collapsed?" hidden":"",h=i.verticalDepth&&s+2>=i.verticalDepth?!0:!1;h||l.append('<tr class="lines'+c+'"><td colspan="'+2*r.length+'"><div class="downLine"></div></td></tr>');for(var p='<tr class="lines'+c+'"><td class="rightLine">&nbsp;</td>',f=1;f<r.length;f++)p+='<td class="leftLine topLine">&nbsp;</td><td class="rightLine topLine">&nbsp;</td>';p+='<td class="leftLine">&nbsp;</td></tr>';var g;h?(g=e("<ul>"),c&&g.addClass(c),s+2===i.verticalDepth?l.append('<tr class="verticalNodes'+c+'"><td></td></tr>').find(".verticalNodes").children().append(g):l.append(g)):(g=e('<tr class="nodes'+c+'">'),l.append(p).append(g)),e.each(r,function(){var t=e(h?"<li>":'<td colspan="2">');g.append(t),L(t,this,s+1,i,a)})}}function j(e,t,n,s){var n=n||e.closest(".orgchart").data("options"),i=t.children||t.siblings;e.find("td:first").attr("colspan",2*i.length),L(e,{children:i},0,n,s)}function q(e,t,n){var n=n||e.closest(".orgchart").data("options"),s=0;j.call(e.closest(".orgchart").parent(),e.closest("table"),t,n,function(){++s===t.children.length&&(e.children(".bottomEdge").length||e.append('<i class="edge verticalEdge bottomEdge fa"></i>'),e.find(".symbol").length||e.children(".title").prepend('<i class="fa '+n.parentNodeSymbol+' symbol"></i>'),v(e))})}function D(t,n,s,i){var a=this,l=e("<table>");n.relationship=n.relationship||"001",e.when(A(n,0,s||t.closest(".orgchart").data("options"))).done(function(e){l.append(e.removeClass("slide-up").addClass("slide-down").wrap('<tr class="hidden"><td colspan="2"></td></tr>').closest("tr")),l.append('<tr class="lines hidden"><td colspan="2"><div class="downLine"></div></td></tr>');var t='<td class="rightLine">&nbsp;</td><td class="leftLine">&nbsp;</td>';l.append('<tr class="lines hidden">'+t+"</tr>");var n=a.children(".orgchart");n.prepend(l).children("table:first").append('<tr class="nodes"><td colspan="2"></td></tr>').children("tr:last").children().append(n.children("table").last()),i()}).fail(function(){console.log("Failed to create parent node")})}function N(e,t,n){D.call(this,e,t,n,function(){e.children(".topEdge").length||e.children(".title").after('<i class="edge verticalEdge topEdge fa"></i>'),f(e)})}function k(e,t,n){for(var s="",i=0;n>i;i++)s+='<td class="leftLine topLine">&nbsp;</td><td class="rightLine topLine">&nbsp;</td>';e.parent().prevAll("tr:gt(0)").children().attr("colspan",2*t).end().next().children(":first").after(s)}function T(t,n,s,i){var s=s||t.closest(".orgchart").data("options"),a=n.siblings?n.siblings.length:n.children.length,l=t.parent().is("td")?t.closest("tr").children().length:1,r=l+a,d=r>1?Math.floor(r/2-1):0;if(t.parent().is("td")){t.closest("tr").prevAll("tr:last");t.closest("tr").prevAll("tr:lt(2)").remove();var o=0;j.call(t.closest(".orgchart").parent(),t.parent().closest("table"),n,s,function(){if(++o===a){var e=t.parent().closest("table").children("tr:last").children("td");l>1?(k(e.eq(0).before(t.closest("td").siblings().addBack().unwrap()),r,l),e.addClass("hidden").find(".node").addClass("slide-left")):(k(e.eq(d).after(t.closest("td").unwrap()),r,1),e.not(":eq("+d+"1)").addClass("hidden").slice(0,d).find(".node").addClass("slide-right").end().end().slice(d).find(".node").addClass("slide-left")),i()}})}else{var c=0;L(t.closest(".orgchart"),n,0,s,function(){++c===r&&(k(t.next().children("tr:last").children().eq(d).after(e('<td colspan="2">').append(t)),r,1),t.closest("tr").siblings().eq(0).addClass("hidden").find(".node").addClass("slide-down"),t.parent().siblings().addClass("hidden").slice(0,d).find(".node").addClass("slide-right").end().end().slice(d).find(".node").addClass("slide-left"),i())})}}function F(e,t,n){T.call(e.closest(".orgchart").parent(),e.closest("table"),t,n,function(){e.closest(".nodes").data("siblingsLoaded",!0),e.children(".leftEdge").length||e.children(".topEdge").after('<i class="edge horizontalEdge rightEdge fa"></i><i class="edge horizontalEdge leftEdge fa"></i>'),b(e)})}function R(e){var t=e.closest("table").parent(),n=t.parent().siblings();t.is("td")?c(e,"siblings").exist?(n.eq(2).children(".topLine:lt(2)").remove(),n.slice(0,2).children().attr("colspan",n.eq(2).children().length),t.remove()):n.eq(0).children().removeAttr("colspan").find(".bottomEdge").remove().end().end().siblings().remove():t.add(t.siblings()).remove()}e.fn.orgchart=function(s){var d={nodeTitle:"name",nodeId:"id",toggleSiblingsResp:!1,depth:999,chartClass:"",exportButton:!1,exportFilename:"OrgChart",exportFileextension:"png",parentNodeSymbol:"fa-users",draggable:!1,direction:"t2b",pan:!1,zoom:!1,zoominLimit:7,zoomoutLimit:.5};switch(s){case"buildHierarchy":return L.apply(this,Array.prototype.splice.call(arguments,1));case"addChildren":return q.apply(this,Array.prototype.splice.call(arguments,1));case"addParent":return N.apply(this,Array.prototype.splice.call(arguments,1));case"addSiblings":return F.apply(this,Array.prototype.splice.call(arguments,1));case"removeNodes":return R.apply(this,Array.prototype.splice.call(arguments,1));case"getHierarchy":return o.apply(this,Array.prototype.splice.call(arguments,1));case"hideParent":return p.apply(this,Array.prototype.splice.call(arguments,1));case"showParent":return f.apply(this,Array.prototype.splice.call(arguments,1));case"hideChildren":return g.apply(this,Array.prototype.splice.call(arguments,1));case"showChildren":return v.apply(this,Array.prototype.splice.call(arguments,1));case"hideSiblings":return u.apply(this,Array.prototype.splice.call(arguments,1));case"showSiblings":return b.apply(this,Array.prototype.splice.call(arguments,1));case"getNodeState":return c.apply(this,Array.prototype.splice.call(arguments,1));case"getRelatedNodes":return h.apply(this,Array.prototype.splice.call(arguments,1));case"setChartScale":return a.apply(this,Array.prototype.splice.call(arguments,1));default:var m=e.extend(d,s)}var C=this,y=m.data,x=e("<div>",{data:{options:m},"class":"orgchart"+(""!==m.chartClass?" "+m.chartClass:"")+("t2b"!==m.direction?" "+m.direction:""),click:function(t){e(t.target).closest(".node").length||x.find(".node.focused").removeClass("focused")}});if("object"===e.type(y)?y instanceof e?L(x,l(y.children()),0,m):L(x,m.ajaxURL?y:r(y,"00"),0,m):e.ajax({url:y,dataType:"json",beforeSend:function(){x.append('<i class="fa fa-circle-o-notch fa-spin spinner"></i>')}}).done(function(e,t,n){L(x,m.ajaxURL?e:r(e,"00"),0,m)}).fail(function(e,t,n){console.log(n)}).always(function(){x.children(".spinner").remove()}),C.append(x),m.exportButton&&!C.find(".oc-export-btn").length){var E=e("<button>",{"class":"oc-export-btn"+(""!==m.chartClass?" "+m.chartClass:""),text:"Export",click:function(s){if(s.preventDefault(),e(this).children(".spinner").length)return!1;var i=C.find(".mask");i.length?i.removeClass("hidden"):C.append('<div class="mask"><i class="fa fa-circle-o-notch fa-spin spinner"></i></div>');var a=C.addClass("canvasContainer").find(".orgchart:visible").get(0),l="l2r"===m.direction||"r2l"===m.direction;html2canvas(a,{width:l?a.clientHeight:a.clientWidth,height:l?a.clientWidth:a.clientHeight,onclone:function(t){e(t).find(".canvasContainer").css("overflow","visible").find(".orgchart:visible:first").css("transform","")},onrendered:function(e){if(C.find(".mask").addClass("hidden"),"pdf"===m.exportFileextension.toLowerCase()){var s={},i=Math.floor(.2646*e.width),a=Math.floor(.2646*e.height);s=i>a?new jsPDF("l","mm",[i,a]):new jsPDF("p","mm",[a,i]),s.addImage(e.toDataURL(),"png",0,0),s.save(m.exportFilename+".pdf")}else{var l="WebkitAppearance"in n.documentElement.style,r=!!t.sidebar,d="Microsoft Internet Explorer"===navigator.appName||"Netscape"===navigator.appName&&navigator.appVersion.indexOf("Edge")>-1;!l&&!r||d?t.navigator.msSaveBlob(e.msToBlob(),m.exportFilename+".png"):C.find(".oc-download-btn").attr("href",e.toDataURL())[0].click()}}}).then(function(){C.removeClass("canvasContainer")},function(){C.removeClass("canvasContainer")})}});if(C.append(E),"pdf"!==m.exportFileextension.toLowerCase()){var w='<a class="oc-download-btn'+(""!==m.chartClass?" "+m.chartClass:"")+'" download="'+m.exportFilename+'.png"></a>';E.after(w)}}return m.pan&&(C.css("overflow","hidden"),x.on("mousedown touchstart",function(t){var n=e(this);if(e(t.target).closest(".node").length||t.touches&&t.touches.length>1)return void n.data("panning",!1);n.css("cursor","move").data("panning",!0);var s=0,i=0,a=n.css("transform");if("none"!==a){var l=a.split(",");-1===a.indexOf("3d")?(s=parseInt(l[4]),i=parseInt(l[5])):(s=parseInt(l[12]),i=parseInt(l[13]))}var r=0,d=0;if(t.targetTouches){if(1===t.targetTouches.length)r=t.targetTouches[0].pageX-s,d=t.targetTouches[0].pageY-i;else if(t.targetTouches.length>1)return}else r=t.pageX-s,d=t.pageY-i;x.on("mousemove touchmove",function(e){if(n.data("panning")){var t=0,s=0;if(e.targetTouches){if(1===e.targetTouches.length)t=e.targetTouches[0].pageX-r,s=e.targetTouches[0].pageY-d;else if(e.targetTouches.length>1)return}else t=e.pageX-r,s=e.pageY-d;var i=n.css("transform");if("none"===i)-1===i.indexOf("3d")?n.css("transform","matrix(1, 0, 0, 1, "+t+", "+s+")"):n.css("transform","matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, "+t+", "+s+", 0, 1)");else{var a=i.split(",");-1===i.indexOf("3d")?(a[4]=" "+t,a[5]=" "+s+")"):(a[12]=" "+t,a[13]=" "+s),n.css("transform",a.join(","))}}})}),e(n).on("mouseup touchend",function(e){x.data("panning")&&x.data("panning",!1).css("cursor","default").off("mousemove")})),m.zoom&&(C.on("wheel",function(e){e.preventDefault();var t=1+(e.originalEvent.deltaY>0?-.2:.2);a(x,t)}),C.on("touchstart",function(e){if(e.touches&&2===e.touches.length){x.data("pinching",!0);var t=i(e);x.data("pinchDistStart",t)}}),e(n).on("touchmove",function(e){if(x.data("pinching")){var t=i(e);x.data("pinchDistEnd",t)}}).on("touchend",function(e){if(x.data("pinching")){x.data("pinching",!1);var t=x.data("pinchDistEnd")-x.data("pinchDistStart");t>0?a(x,1.2):0>t&&a(x,.8)}})),C}});